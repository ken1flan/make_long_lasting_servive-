# 動機と環境、そして戦略

## 動機

### academist

自分の趣味の一つに科学ネタを読むというのがあります。
いつもどおり、Pawooやらはてブやらを覗いていたら、[「深海生物「テヅルモヅル」の研究者がクラウドファンディングで研究費を集めたワケ」という記事がブースト](https://kurage.cc/@yi0713/102072309114373460)されてて…そこで[academist](https://academist-cf.com/)を知ったのでした。
たった数十万の研究費があれば、おもしろい研究が世の中にリリースされていく…！そのためのインフラとしての、クラウドファンディング…！なるほど、それは名案、ぜひ参加したい！と思って、募集もされてなかったところに地道にアプローチをして、今に至っています。

## 当時の状況

その自分が気に入っているサービスに無事にジョインすることが決まり、その裏側を見れるようになったところ…。
Railsのバージョンは5.1、すでにメンテナンスをされていないバージョンでした。また、テストはほとんどありませんでした。Rails6に上げる作業は始められていたのですが、滞っていました。Gemは古いまま放置され、バージョンを上げるときには「度胸」がいる状態でした。当然、新機能のリリースも「度胸」で行われていました。

幸い、サービスの利用者はまだacademistのことをよく知っている方が多く、何かしら不具合があったときには連絡をくれるなど、まだまだ小さいサービスならではの牧歌的な状況でした。
ですが、これでは、何かしら問題が起きたときに、全く言い訳ができない状態でした。サービスになにかしら問題があったときに、もしかしたらなくなってしまうかもしれません。

システムが問題でサービスを終了させてしまうことは、とても耐えられません。自分はとてもこのサービスが気に入っているのです。

幸い、開発メンバーも同じ思いでしたので、なんとかしようと思い立ちました。

## 環境

- Ruby2.4.5
- Rails5.1.6.2
- AWS
  - Elastic Beanstalk

## 戦略

必達の目標は、RubyとRailsをメンテナンスされているバージョン、つまりRuby2.6系とRails5.2系にすることです。
できれば、Ruby2.7系、Rails6.0系まで上げたいところですが、いったんここまでにします。

戦略…というほど大げさなことはありません。
[Railsガイド](https://railsguides.jp/)の[Rails アップグレードガイド](https://railsguides.jp/upgrading_ruby_on_rails.html)に従って行うだけです。

大きな流れは下記の通りです。

1. Rails以外のGemを最新にする
2. Railsを最新のパッチバージョンにする。
3. Railsを次のバージョンに上げ、手順に従って、設定を変更する。

これをacademistに割り当てると…

1. Rails以外のGemを最新にする
2. Railsを5.1系最新のパッチバージョンにする。
3. Railsを5.2系最新のバージョンに上げ、手順に従って、設定を変更する。
4. Ruby2.6系最新に上げる

逐一壊れていないことを証明するには、academistにはほとんどテストが書かれていませんでした。これではなにかするたびに自分でテストをぽちぽち行うか、「ええい、ままよ！」とするしかありません。
面倒くさがりで小心者の自分にはできないことと、今後もずっと使い続けられるので、地道にテストを準備することにしました。

0. テストの準備
1. Rails以外のGemを最新にする
2. Railsを5.1系最新のパッチバージョンにする。
3. Railsを5.2系最新のバージョンに上げ、手順に従って、設定を変更する。
4. Ruby2.6系最新に上げる

テストの準備ですが…ここは大変です。100%現在あるシステムの動作を記述するものを用意しようとするのは開発にかけた時間と同じくらいか、その仕様を知らない分、余計にかかってしまうでしょう。

そういうわけで、対象をグッと狭くすることにしました。ビジネスでどうしても動いていなくてはならない部分にだけテストを準備することにしました。そうすれば、そこが壊れれば気がつけるし、そこ以外の場合はビジネスに於いてクリティカルではないので、気付き次第直せばよいのです。

また、Rubyのバージョンも上げる必要があります。
Ruby2.4は?年?月?日にEOLになりました。また、Rails6はRuby2.6以上である必要があります。
とりあえず、2.6に上げることにします。

0. テストの準備
1. Rails以外のGemを最新にする
2. Railsを5.1系最新のパッチバージョンにする。
3. Railsを5.2系最新のバージョンに上げ、手順に従って、設定を変更する
4. Rubyを2.6に上げる

こんな順番で作業をすることにしました。
